<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Workout App - Main</title>

  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: Arial, sans-serif;
      background: #f4f5f7;
      color: #111827;
      height: 100vh;
    }

    .app {
      display: flex;
      height: 100vh;
    }

    /* Sidebar */
    .sidebar {
      width: 230px;
      background: #111827;
      color: #e5e7eb;
      padding: 20px 15px;
      display: flex;
      flex-direction: column;
    }

    .logo {
      font-size: 20px;
      font-weight: bold;
      margin-bottom: 25px;
      text-align: center;
    }

    .menu-title {
      font-size: 12px;
      text-transform: uppercase;
      color: #9ca3af;
      margin-bottom: 8px;
      letter-spacing: 1px;
    }

    .nav-item {
      padding: 10px 12px;
      border-radius: 8px;
      margin-bottom: 6px;
      cursor: pointer;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .nav-item:hover {
      background: #1f2937;
    }

    .nav-item.active {
      background: #2563eb;
      color: white;
    }

    .sidebar-footer {
      margin-top: auto;
      font-size: 12px;
      color: #9ca3af;
      text-align: center;
      padding-top: 15px;
      border-top: 1px solid #1f2937;
    }

    /* Main content */
    .main {
      flex: 1;
      padding: 20px 25px;
      overflow-y: auto;
    }

    .main-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .header-right {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .main-header h1 {
      font-size: 22px;
    }

    .user-badge {
      font-size: 14px;
      background: white;
      padding: 8px 12px;
      border-radius: 999px;
      box-shadow: 0 0 5px rgba(0,0,0,0.06);
    }

    .card {
      background: white;
      border-radius: 12px;
      padding: 18px;
      box-shadow: 0 0 8px rgba(0,0,0,0.05);
      margin-bottom: 16px;
    }

    .card h2 {
      font-size: 18px;
      margin-bottom: 10px;
    }

    .muted {
      color: #6b7280;
      font-size: 14px;
    }

    /* Sections */
    .section {
      display: none;
    }

    .section.active {
      display: block;
    }

    /* Forms */
    .form-group {
      margin-bottom: 12px;
    }

    .form-group label {
      display: block;
      font-size: 14px;
      margin-bottom: 4px;
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 8px;
      border-radius: 6px;
      border: 1px solid #d1d5db;
      font-size: 14px;
    }

    textarea {
      resize: vertical;
    }

    /* Designer exercise rows */
    .exercise-row {
      display: grid;
      grid-template-columns: 2fr 1fr 1fr auto;
      gap: 8px;
      margin-bottom: 8px;
      align-items: center;
    }

    .exercise-row input {
      padding: 6px;
      font-size: 13px;
    }

    /* Buttons */
    .btn {
      display: inline-block;
      padding: 8px 12px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-size: 14px;
    }

    .btn-primary {
      background: #2563eb;
      color: #fff;
    }

    .btn-secondary {
      background: #e5e7eb;
      color: #111827;
    }

    .btn-danger {
      background: #ef4444;
      color: #fff;
    }

    .btn-sm {
      padding: 4px 8px;
      font-size: 12px;
      border-radius: 6px;
    }

    .btn + .btn {
      margin-left: 6px;
    }

    #saveMessage,
    #sessionMessage {
      font-size: 14px;
      margin-top: 8px;
    }

    .success {
      color: #16a34a;
    }

    .error {
      color: #dc2626;
    }

    #savedWorkoutsList,
    #sessionList {
      margin-top: 8px;
      padding-left: 18px;
    }

    #savedWorkoutsList li,
    #sessionList li {
      margin-bottom: 4px;
      font-size: 14px;
    }

    /* Do Workout exercise cards with tables */
    .exercise-card {
      margin-bottom: 16px;
      padding: 12px;
      border-radius: 10px;
      background: #f9fafb;
      border: 1px solid #e5e7eb;
    }

    .exercise-header {
      font-weight: bold;
      margin-bottom: 8px;
    }

    .sets-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
    }

    .sets-table th,
    .sets-table td {
      padding: 6px;
      text-align: left;
    }

    .sets-table th {
      border-bottom: 1px solid #e5e7eb;
    }

    .sets-table input {
      width: 100%;
      padding: 4px 6px;
      border-radius: 6px;
      border: 1px solid #d1d5db;
      font-size: 13px;
      box-sizing: border-box;
    }

    /* Progress chart */
    #progressChart {
      width: 100%;
      max-width: 100%;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      background: #ffffff;
      display: block;
      margin-top: 10px;
    }

    /* Dark mode */
    body.dark {
      background: #020617;
      color: #e5e7eb;
    }

    body.dark .sidebar {
      background: #020617;
      color: #e5e7eb;
    }

    body.dark .main {
      background: #020617;
    }

    body.dark .card {
      background: #020617;
      border: 1px solid #1f2937;
      box-shadow: none;
    }

    body.dark .user-badge {
      background: #0f172a;
      color: #e5e7eb;
    }

    body.dark .exercise-card {
      background: #020617;
      border-color: #1f2937;
    }

    body.dark input,
    body.dark select,
    body.dark textarea {
      background: #020617;
      color: #e5e7eb;
      border-color: #4b5563;
    }

    body.dark .nav-item:hover {
      background: #1f2937;
    }

    body.dark #progressChart {
      background: #020617;
      border-color: #1f2937;
    }
  </style>
</head>
<body>
  <div class="app">
    <!-- SIDEBAR -->
    <aside class="sidebar">
      <div class="logo">Workout App</div>

      <div class="menu-title">Menu</div>

      <div class="nav-item active" data-target="section-design">üõ†Ô∏è Design Workout</div>
      <div class="nav-item" data-target="section-do">üí™ Do Workout</div>
      <div class="nav-item" data-target="section-previous">üìä Previous Workouts</div>
      <div class="nav-item" data-target="section-more">‚öôÔ∏è More (coming soon)</div>

      <div class="sidebar-footer">
        v0.5 ‚Ä¢ MVP layout
      </div>
    </aside>

    <!-- MAIN -->
    <main class="main">
      <div class="main-header">
        <h1 id="sectionTitle">Design Workout</h1>
        <div class="header-right">
          <button id="themeToggleBtn" class="btn btn-secondary">Dark mode</button>
          <div class="user-badge">
            Logged in as: <strong>test@example.com</strong>
          </div>
        </div>
      </div>

      <!-- DESIGN WORKOUT SECTION -->
      <section id="section-design" class="section active">
        <div class="card">
          <h2>Create / edit workout</h2>
          <p class="muted" style="margin-bottom: 12px;">
            Give your workout a name and add exercises with sets and reps.
          </p>

          <div class="form-group">
            <label for="workoutName">Workout name</label>
            <input type="text" id="workoutName" placeholder="e.g. Chest & Shoulders">
          </div>

          <div class="form-group">
            <label>Exercises</label>
            <div id="exerciseList"></div>
            <button type="button" class="btn btn-secondary" id="addExerciseBtn">+ Add exercise</button>
          </div>

          <button type="button" class="btn btn-primary" id="saveWorkoutBtn">Save workout</button>
          <div id="saveMessage"></div>
        </div>

        <div class="card">
          <h2>Saved workouts</h2>
          <p class="muted">
            Edit, duplicate, delete, or export your saved workouts.
          </p>
          <button type="button" class="btn btn-secondary" id="exportWorkoutsBtn">Export workouts (JSON)</button>
          <ul id="savedWorkoutsList"></ul>
        </div>
      </section>

      <!-- DO WORKOUT SECTION -->
      <section id="section-do" class="section">
        <div class="card">
          <h2>Start a workout</h2>
          <p class="muted" style="margin-bottom: 12px;">
            Select one of your saved workouts, choose a date, then log the weight and reps you used for every set.
          </p>

          <div class="form-group">
            <label for="doWorkoutSelect">Choose workout</label>
            <select id="doWorkoutSelect"></select>
          </div>

          <div class="form-group">
            <label for="doWorkoutDate">Date</label>
            <input type="date" id="doWorkoutDate">
          </div>
        </div>

        <div class="card">
          <h2>Exercises for this workout</h2>
          <p class="muted">
            For each exercise, enter the weight and reps for every set.
          </p>
          <div id="doExercisesContainer"></div>
        </div>

        <div class="card">
          <h2>Notes & save</h2>
          <div class="form-group">
            <label for="doNotes">Notes (optional)</label>
            <textarea id="doNotes" rows="3" placeholder="e.g. Felt strong today, increase bench next week."></textarea>
          </div>
          <button type="button" class="btn btn-primary" id="saveSessionBtn">Save workout session</button>
          <div id="sessionMessage"></div>
        </div>
      </section>

      <!-- PREVIOUS WORKOUTS SECTION -->
      <section id="section-previous" class="section">
        <div class="card">
          <h2>Previous workouts</h2>
          <p class="muted">
            These are the sessions you logged from the "Do Workout" page.
          </p>
          <ul id="sessionList"></ul>
        </div>

        <div class="card">
          <h2>Progress graph</h2>
          <p class="muted">
            Select an exercise to see how your weight has changed over time.
          </p>
          <div class="form-group">
            <label for="progressExerciseSelect">Choose exercise</label>
            <select id="progressExerciseSelect"></select>
          </div>
          <canvas id="progressChart" width="600" height="300"></canvas>
          <p id="progressMessage" class="muted"></p>
        </div>
      </section>

      <!-- MORE SECTION -->
      <section id="section-more" class="section">
        <div class="card">
          <h2>More (coming soon)</h2>
          <p class="muted">
            Future features could include profile, settings, advanced analytics, and more.
          </p>
        </div>
      </section>

    </main>
  </div>

  <script>
    // ---------- GLOBAL STATE ----------
    let workouts = [];
    let sessions = [];
    let editingWorkoutIndex = null;

    // ---------- LOAD / SAVE ----------
    function loadWorkouts() {
      try {
        workouts = JSON.parse(localStorage.getItem("workouts") || "[]");
      } catch {
        workouts = [];
      }
    }

    function saveWorkouts() {
      localStorage.setItem("workouts", JSON.stringify(workouts));
    }

    function loadSessions() {
      try {
        sessions = JSON.parse(localStorage.getItem("sessions") || "[]");
      } catch {
        sessions = [];
      }
    }

    function saveSessions() {
      localStorage.setItem("sessions", JSON.stringify(sessions));
    }

    // ---------- THEME ----------
    const themeToggleBtn = document.getElementById("themeToggleBtn");

    function applyTheme(theme) {
      if (theme === "dark") {
        document.body.classList.add("dark");
        themeToggleBtn.textContent = "Light mode";
      } else {
        document.body.classList.remove("dark");
        themeToggleBtn.textContent = "Dark mode";
      }
    }

    function initTheme() {
      const savedTheme = localStorage.getItem("theme") || "light";
      applyTheme(savedTheme);
    }

    themeToggleBtn.addEventListener("click", () => {
      const isDark = document.body.classList.contains("dark");
      const newTheme = isDark ? "light" : "dark";
      localStorage.setItem("theme", newTheme);
      applyTheme(newTheme);
    });

    // ---------- SIDEBAR NAV ----------
    const navItems = document.querySelectorAll(".nav-item");
    const sections = document.querySelectorAll(".section");
    const sectionTitle = document.getElementById("sectionTitle");

    navItems.forEach(item => {
      item.addEventListener("click", () => {
        navItems.forEach(i => i.classList.remove("active"));
        item.classList.add("active");

        const targetId = item.getAttribute("data-target");
        sections.forEach(sec => {
          sec.classList.toggle("active", sec.id === targetId);
        });

        sectionTitle.textContent = item.textContent.trim();
      });
    });

    // ---------- DESIGN WORKOUT ----------
    const workoutNameInput = document.getElementById("workoutName");
    const exerciseListEl = document.getElementById("exerciseList");
    const saveWorkoutBtn = document.getElementById("saveWorkoutBtn");
    const saveMessageEl = document.getElementById("saveMessage");
    const savedWorkoutsListEl = document.getElementById("savedWorkoutsList");
    const exportWorkoutsBtn = document.getElementById("exportWorkoutsBtn");

    function addExerciseRow(defaults = {}) {
      const row = document.createElement("div");
      row.className = "exercise-row";
      row.innerHTML = `
        <input type="text" class="exercise-name" placeholder="Exercise name" value="${defaults.name || ""}">
        <input type="number" class="exercise-sets" placeholder="Sets" min="1" value="${defaults.sets || ""}">
        <input type="number" class="exercise-reps" placeholder="Reps" min="1" value="${defaults.reps || ""}">
        <button type="button" class="btn btn-danger btn-sm remove-exercise">X</button>
      `;
      row.querySelector(".remove-exercise").addEventListener("click", () => row.remove());
      exerciseListEl.appendChild(row);
    }

    document.getElementById("addExerciseBtn").addEventListener("click", () => addExerciseRow());

    function showMessage(el, text, type) {
      el.textContent = text;
      el.className = "";
      if (type) el.classList.add(type);
    }

    function renderSavedWorkouts() {
      savedWorkoutsListEl.innerHTML = "";

      if (workouts.length === 0) {
        savedWorkoutsListEl.innerHTML = `<li class="muted">No workouts saved yet.</li>`;
        return;
      }

      workouts.forEach((w, index) => {
        const li = document.createElement("li");
        li.innerHTML = `
          ${index + 1}. ${w.name} (${w.exercises.length} exercises)
          <button class="btn btn-secondary btn-sm edit-workout-btn" data-index="${index}">Edit</button>
          <button class="btn btn-secondary btn-sm duplicate-workout-btn" data-index="${index}">Duplicate</button>
          <button class="btn btn-danger btn-sm delete-workout-btn" data-index="${index}">Delete</button>
        `;
        savedWorkoutsListEl.appendChild(li);
      });

      // Attach button handlers
      document.querySelectorAll(".edit-workout-btn").forEach(btn => {
        btn.addEventListener("click", () => {
          const index = Number(btn.getAttribute("data-index"));
          startEditWorkout(index);
        });
      });

      document.querySelectorAll(".duplicate-workout-btn").forEach(btn => {
        btn.addEventListener("click", () => {
          const index = Number(btn.getAttribute("data-index"));
          duplicateWorkout(index);
        });
      });

      document.querySelectorAll(".delete-workout-btn").forEach(btn => {
        btn.addEventListener("click", () => {
          const index = Number(btn.getAttribute("data-index"));
          deleteWorkout(index);
        });
      });
    }

    function resetDesignerForm() {
      editingWorkoutIndex = null;
      workoutNameInput.value = "";
      exerciseListEl.innerHTML = "";
      addExerciseRow();
      saveWorkoutBtn.textContent = "Save workout";
      showMessage(saveMessageEl, "", "");
    }

    function startEditWorkout(index) {
      const w = workouts[index];
      editingWorkoutIndex = index;
      workoutNameInput.value = w.name;
      exerciseListEl.innerHTML = "";
      w.exercises.forEach(ex => addExerciseRow(ex));
      saveWorkoutBtn.textContent = "Update workout";
      showMessage(saveMessageEl, `Editing workout: "${w.name}"`, "muted");
    }

    function duplicateWorkout(index) {
      const original = workouts[index];
      const copy = JSON.parse(JSON.stringify(original));
      copy.name = original.name + " (copy)";
      workouts.push(copy);
      saveWorkouts();
      renderSavedWorkouts();
      populateWorkoutSelect();
      alert("Workout duplicated.");
    }

    function deleteWorkout(index) {
      if (!confirm("Are you sure you want to delete this workout?")) return;
      workouts.splice(index, 1);
      saveWorkouts();
      renderSavedWorkouts();
      populateWorkoutSelect();
      // If we were editing this workout, reset the form
      resetDesignerForm();
      // Clear Do Workout exercises if necessary
      doExercisesContainer.innerHTML = "";
    }

    function saveWorkout() {
      const name = workoutNameInput.value.trim();
      if (!name) {
        showMessage(saveMessageEl, "Please enter a workout name.", "error");
        return;
      }

      const rows = exerciseListEl.querySelectorAll(".exercise-row");
      if (rows.length === 0) {
        showMessage(saveMessageEl, "Please add at least one exercise.", "error");
        return;
      }

      const exercises = [];
      for (const row of rows) {
        const exName = row.querySelector(".exercise-name").value.trim();
        const sets = Number(row.querySelector(".exercise-sets").value);
        const reps = Number(row.querySelector(".exercise-reps").value);

        if (!exName || !sets || !reps) {
          showMessage(saveMessageEl, "Please fill in all exercise fields.", "error");
          return;
        }

        exercises.push({ name: exName, sets, reps });
      }

      const workout = { name, exercises };

      if (editingWorkoutIndex !== null) {
        workouts[editingWorkoutIndex] = workout;
        showMessage(saveMessageEl, "Workout updated successfully!", "success");
      } else {
        workouts.push(workout);
        showMessage(saveMessageEl, "Workout saved successfully!", "success");
      }

      saveWorkouts();
      renderSavedWorkouts();
      populateWorkoutSelect();
      resetDesignerForm();
    }

    saveWorkoutBtn.addEventListener("click", saveWorkout);

    // Export workouts as JSON
    exportWorkoutsBtn.addEventListener("click", () => {
      if (workouts.length === 0) {
        alert("No workouts to export.");
        return;
      }
      const data = JSON.stringify(workouts, null, 2);
      const blob = new Blob([data], { type: "application/json" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "workouts.json";
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    });

    // ---------- DO WORKOUT ----------
    const doWorkoutSelect = document.getElementById("doWorkoutSelect");
    const doWorkoutDate = document.getElementById("doWorkoutDate");
    const doExercisesContainer = document.getElementById("doExercisesContainer");
    const doNotes = document.getElementById("doNotes");
    const saveSessionBtn = document.getElementById("saveSessionBtn");
    const sessionMessageEl = document.getElementById("sessionMessage");

    function setTodayDate() {
      const today = new Date();
      const yyyy = today.getFullYear();
      const mm = String(today.getMonth() + 1).padStart(2, "0");
      const dd = String(today.getDate()).padStart(2, "0");
      doWorkoutDate.value = `${yyyy}-${mm}-${dd}`;
    }

    function populateWorkoutSelect() {
      doWorkoutSelect.innerHTML = "";
      if (workouts.length === 0) {
        const opt = document.createElement("option");
        opt.value = "";
        opt.textContent = "No workouts available";
        doWorkoutSelect.appendChild(opt);
        doWorkoutSelect.disabled = true;
        return;
      }

      doWorkoutSelect.disabled = false;
      const placeholder = document.createElement("option");
      placeholder.value = "";
      placeholder.textContent = "Select a workout";
      doWorkoutSelect.appendChild(placeholder);

      workouts.forEach((w, index) => {
        const opt = document.createElement("option");
        opt.value = index;
        opt.textContent = w.name;
        doWorkoutSelect.appendChild(opt);
      });
    }

    function renderDoExercises(workoutIndex) {
      doExercisesContainer.innerHTML = "";
      if (workoutIndex === "" || workoutIndex == null) return;

      const workout = workouts[workoutIndex];

      workout.exercises.forEach((ex, exIndex) => {
        const card = document.createElement("div");
        card.className = "exercise-card";
        card.dataset.exerciseIndex = exIndex;

        let rowsHtml = "";
        for (let setNum = 1; setNum <= ex.sets; setNum++) {
          rowsHtml += `
            <tr data-set-index="${setNum - 1}">
              <td>Set ${setNum}</td>
              <td><input type="number" class="set-weight" placeholder="e.g. 40" min="0"></td>
              <td><input type="number" class="set-reps" placeholder="${ex.reps}" min="0"></td>
            </tr>
          `;
        }

        card.innerHTML = `
          <div class="exercise-header">
            ${ex.name} ‚Äî ${ex.sets} sets √ó ${ex.reps} reps (planned)
          </div>
          <table class="sets-table">
            <thead>
              <tr>
                <th>Set</th>
                <th>Weight (kg)</th>
                <th>Reps</th>
              </tr>
            </thead>
            <tbody>
              ${rowsHtml}
            </tbody>
          </table>
        `;

        doExercisesContainer.appendChild(card);
      });
    }

    doWorkoutSelect.addEventListener("change", (e) => {
      const index = e.target.value;
      renderDoExercises(index);
    });

    function saveSession() {
      const workoutIndex = doWorkoutSelect.value;
      if (workoutIndex === "") {
        showMessage(sessionMessageEl, "Please select a workout.", "error");
        return;
      }

      const date = doWorkoutDate.value;
      if (!date) {
        showMessage(sessionMessageEl, "Please choose a date.", "error");
        return;
      }

      const workout = workouts[workoutIndex];
      const cards = doExercisesContainer.querySelectorAll(".exercise-card");
      if (cards.length === 0) {
        showMessage(sessionMessageEl, "No exercises to log. Check your workout.", "error");
        return;
      }

      const exercisesLogged = [];

      for (const card of cards) {
        const exIndex = Number(card.dataset.exerciseIndex);
        const baseExercise = workout.exercises[exIndex];

        const rows = card.querySelectorAll("tbody tr");
        const setsLogged = [];

        for (let i = 0; i < rows.length; i++) {
          const row = rows[i];
          const weightVal = row.querySelector(".set-weight").value;
          const repsVal = row.querySelector(".set-reps").value;

          if (!weightVal || !repsVal) {
            showMessage(sessionMessageEl, "Please enter weight and reps for all sets.", "error");
            return;
          }

          setsLogged.push({
            setNumber: i + 1,
            weight: Number(weightVal),
            reps: Number(repsVal)
          });
        }

        exercisesLogged.push({
          name: baseExercise.name,
          plannedSets: baseExercise.sets,
          plannedReps: baseExercise.reps,
          sets: setsLogged
        });
      }

      const notes = doNotes.value.trim();

      const session = {
        date,
        workoutName: workout.name,
        exercises: exercisesLogged,
        notes
      };

      sessions.push(session);
      saveSessions();

      showMessage(sessionMessageEl, "Workout session saved!", "success");

      // Reset notes & keep workout visible
      doNotes.value = "";
      doExercisesContainer.querySelectorAll(".set-weight").forEach(input => input.value = "");
      doExercisesContainer.querySelectorAll(".set-reps").forEach(input => input.value = "");

      renderSessions();
      updateExerciseOptions();
    }

    saveSessionBtn.addEventListener("click", saveSession);

    // ---------- PREVIOUS WORKOUTS & PROGRESS ----------
    const sessionListEl = document.getElementById("sessionList");
    const progressExerciseSelect = document.getElementById("progressExerciseSelect");
    const progressChart = document.getElementById("progressChart");
    const progressMessage = document.getElementById("progressMessage");
    const progressCtx = progressChart.getContext("2d");

    function renderSessions() {
      sessionListEl.innerHTML = "";
      if (sessions.length === 0) {
        sessionListEl.innerHTML = `<li class="muted">No sessions saved yet.</li>`;
        return;
      }

      sessions
        .slice()
        .reverse()
        .forEach(s => {
          const li = document.createElement("li");
          li.textContent = `${s.date} ‚Äî ${s.workoutName}`;
          sessionListEl.appendChild(li);
        });
    }

    function clearChart() {
      progressCtx.clearRect(0, 0, progressChart.width, progressChart.height);
    }

    function updateExerciseOptions() {
      progressExerciseSelect.innerHTML = "";
      const names = new Set();

      sessions.forEach(s => {
        (s.exercises || []).forEach(e => names.add(e.name));
      });

      if (names.size === 0) {
        const opt = document.createElement("option");
        opt.value = "";
        opt.textContent = "No data";
        progressExerciseSelect.appendChild(opt);
        progressExerciseSelect.disabled = true;
        progressMessage.textContent = "No exercise data yet. Log some sessions first.";
        clearChart();
        return;
      }

      progressExerciseSelect.disabled = true; // until user selects
      const placeholder = document.createElement("option");
      placeholder.value = "";
      placeholder.textContent = "Select an exercise";
      progressExerciseSelect.appendChild(placeholder);

      names.forEach(name => {
        const opt = document.createElement("option");
        opt.value = name;
        opt.textContent = name;
        progressExerciseSelect.appendChild(opt);
      });

      progressExerciseSelect.disabled = false;
      progressMessage.textContent = "Select an exercise to see progress.";
      clearChart();
    }

    function drawProgressChart(exName) {
      if (!exName) {
        progressMessage.textContent = "Select an exercise to see progress.";
        clearChart();
        return;
      }

      const history = [];

      sessions.forEach(s => {
        const ex = (s.exercises || []).find(e => e.name === exName);
        if (ex && ex.sets && ex.sets.length > 0) {
          const last = ex.sets[ex.sets.length - 1];
          history.push({ date: s.date, weight: last.weight });
        }
      });

      if (history.length === 0) {
        progressMessage.textContent = "No data for this exercise yet.";
        clearChart();
        return;
      }

      // Sort by date
      history.sort((a, b) => new Date(a.date) - new Date(b.date));

      const padding = 30;
      const w = progressChart.width;
      const h = progressChart.height;

      clearChart();

      // Axes
      progressCtx.strokeStyle = "#9ca3af";
      progressCtx.lineWidth = 1;
      progressCtx.beginPath();
      progressCtx.moveTo(padding, padding);
      progressCtx.lineTo(padding, h - padding);
      progressCtx.lineTo(w - padding, h - padding);
      progressCtx.stroke();

      const weights = history.map(p => p.weight);
      const minW = Math.min(...weights);
      const maxW = Math.max(...weights);
      const range = maxW - minW || 1;
      const xStep = (w - 2 * padding) / Math.max(history.length - 1, 1);

      // Line
      progressCtx.lineWidth = 2;
      progressCtx.strokeStyle = "#2563eb";
      progressCtx.beginPath();

      history.forEach((p, idx) => {
        const x = padding + xStep * idx;
        const norm = (p.weight - minW) / range;
        const y = (h - padding) - norm * (h - 2 * padding);
        if (idx === 0) {
          progressCtx.moveTo(x, y);
        } else {
          progressCtx.lineTo(x, y);
        }
      });
      progressCtx.stroke();

      // Points
      progressCtx.fillStyle = "#2563eb";
      history.forEach((p, idx) => {
        const x = padding + xStep * idx;
        const norm = (p.weight - minW) / range;
        const y = (h - padding) - norm * (h - 2 * padding);
        progressCtx.beginPath();
        progressCtx.arc(x, y, 3, 0, Math.PI * 2);
        progressCtx.fill();
      });

      progressMessage.textContent = `Showing ${history.length} sessions for ${exName}.`;
    }

    progressExerciseSelect.addEventListener("change", () => {
      const exName = progressExerciseSelect.value;
      drawProgressChart(exName);
    });

    // ---------- INIT ----------
    function init() {
      initTheme();
      loadWorkouts();
      loadSessions();

      renderSavedWorkouts();
      populateWorkoutSelect();
      renderSessions();
      updateExerciseOptions();
      resetDesignerForm();
      setTodayDate();
    }

    init();
  </script>
</body>
</html>
